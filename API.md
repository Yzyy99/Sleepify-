# API Documentation

## Endpoints Overview

| Endpoint                       | Method | Description                                     |
| ------------------------------ | ------ | ----------------------------------------------- |
| `/api/login/`                  | POST   | Authenticates user and returns JWT tokens.      |
| `/api/token/refresh/`          | POST   | Refreshes access token using the refresh token. |
| `/api/send_verification_code/` | POST   | Send temporary code.                            |
| `/api/verify-code/`            | POST   | Verify the code and token and login.            |
| `/api/logout/`                 | POST   | Logout                                          |
| `/api/forum/posts/`            | POST   | Retrieve 10 forum posts since specific index.   |
| `/api/forum/post_pictures/{postid}/{picture_index}/` | POST    | Retrieve a specific picture from a forum post.   |

---

## Detailed Endpoint Specifications

### 1. User Login

| **Field**  | **Type** | **Description**                                   | **Required** |
| ---------- | -------- | ------------------------------------------------- | ------------ |
| `username` | `string` | The user's username.(actually it is phone number) | Yes          |
| `password` | `string` | The user's password.                              | Yes          |

**Request Example**:
```json
{
    "username": "example_user",
    "password": "example_password"
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `refresh` | `string` | Refresh token.  |
| `access`  | `string` | Access token.   |

```json
{
    "refresh": "<refresh_token>",
    "access": "<access_token>"
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Invalid username or password"
}
```

---

### 2. Token Refresh

| **Field** | **Type** | **Description**    | **Required** |
| --------- | -------- | ------------------ | ------------ |
| `refresh` | `string` | The refresh token. | Yes          |

**Request Example**:
```json
{
    "refresh": "<refresh_token>"
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description**   |
| --------- | -------- | ----------------- |
| `access`  | `string` | New access token. |

```json
{
    "access": "<new_access_token>"
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Invalid or expired refresh token"
}
```

---
### 3. Send SMS Code

| **Field**      | **Type** | **Description**   | **Required** |
| -------------- | -------- | ----------------- | ------------ |
| `phone_number` | `string` | The Phone Number. | Yes          |

**Request Example**:
```json
{
    "phone_number": "<phone_number>"
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description**                       |
| --------- | -------- | ------------------------------------- |
| `token`   | `string` | Temp token for specific phone number. |

```json
{
    "token": "<token>",
    "message": "Verification code sent successfully."
}
```

**Error Response (400 Bad request)**:

| **Field** | **Type** | **Description**                                  |
| --------- | -------- | ------------------------------------------------ |
| `error`   | `string` | if phone number is invalid OR it already exists. |
```json
{
    "error": "Phone number is required."
}
```
**Error Response (409 Conflict)**:

| **Field** | **Type** | **Description**                                  |
| --------- | -------- | ------------------------------------------------ |
| `error`   | `string` | if phone number is invalid OR it already exists. |

```json
{
    "error": "User with this phone number already exists."
}
```
**Error Response (429 Too many requests)**:

| **Field** | **Type** | **Description**          |
| --------- | -------- | ------------------------ |
| `error`   | `string` | if post again in 60 sec. |

```json
{
    "error": "Please wait before requesting another code."
}
```
---
### 4. Verify SMS Code and Register 

| **Field**  | **Type** | **Description**                      | **Required** |
| ---------- | -------- | ------------------------------------ | ------------ |
| `token`    | `string` | The Token generated By Phone Number. | Yes          |
| `code`     | `string` | The SMS Code.                        | Yes          |
| `password` | `string` | The Register Password.               | Yes          |

**Request Example**:
```json
{
    "token": "<token>",
    "code": "<code>",
    "password": "<password>"
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description**                       |
| --------- | -------- | ------------------------------------- |
| `refresh` | `string` | Refresh token.  |
| `access`  | `string` | Access token.   |

```json
{
    "refresh": "<refresh_token>",
    "access": "<access_token>"
}
```

**Error Response (400 Bad request)**:

| **Field** | **Type** | **Description**                                          |
| --------- | -------- | -------------------------------------------------------- |
| `error`   | `string` | if token expired OR token is invalid OR code is invalid. |

```json
{
    "error": "The token has expired."
}
```
```json
{
    "error": "Invalid or expired verification code."
}
```
```json
{
    "error": "Invalid token."
}
```
### 5. Logout 

| **Field**  | **Type** | **Description**                              | **Required** |
| ---------- | -------- | -------------------------------------------- | ------------ |
| `refresh`  | `string` | The Refresh Token generated By Phone Number. | Yes          |

**Request Example**:
```json
{
    "refresh": "<refresh_token>"
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description**                       |
| --------- | -------- | ------------------------------------- |
| `message` | `string` | Success. |

```json
{
    "message": "Successfully logged out."
}
```

**Error Response (400 Bad request)**:

| **Field** | **Type** | **Description**                            |
| --------- | -------- | ------------------------------------------ |
| `error`   | `string` | if token not provided OR token is invalid. |

```json
{
    "error": "Refresh token is required."
}
```
```json
{
    "error": "Invalid token."
}
```

### 6. Get Forum Posts

| **Field** | **Type** | **Description** | **Required** |
| --------- | -------- | --------------- | ------------ |
| `Authorization` | `string` | Access token for authentication. | Yes |
| `last_post_id` | `integer` | ID of the last post retrieved (for pagination). If null, response the latest 10. | No |

**Request Example**:
```json
{
    "Authorization": "Bearer <access_token>",
    "last_post_id": 10
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `posts`   | `array`  | List of forum posts. |

```json
{
    "posts": [
        {
            "postid": 1,
            "username": "user1",
            "content": "This is a forum post.",
            "created_at": "2023-10-01T12:34:56Z",
            "picture_count": 2,
            "likes": 5,
            "replies": 1,
            "reply_content": [
                {
                    "reply_id": 1,
                    "username": "user3",
                    "content": "This is a reply."
                }
            ],
            "isliked": true
        },
        {
            "postid": 2,
            "username": "user2",
            "content": "This is another forum post.",
            "created_at": "2023-10-02T14:56:78Z",
            "picture_count": 0,
            "likes": 3,
            "replies": 0,
            "reply_content": [],
            "isliked": false
        }
    ]
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Access token is required"
}
```

### 7. Get Forum Picture

| **Field** | **Type** | **Description** | **Required** |
| --------- | -------- | --------------- | ------------ |
| `Authorization` | `string` | Access token for authentication. | Yes |
| `postid` | `integer` | ID of the forum post. | Yes |
| `picture_index` | `integer` | Index of the picture in the post. | Yes |

**Request Example**:
```json
{
    "Authorization": "Bearer <access_token>",
    "postid": 1,
    "picture_index": 0
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `image`   | `string` | Base64 encoded image. |

```json
{
    "image": "<base64_encoded_image>"
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Access token is required"
}
```

**Error Response (404 Not Found)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Picture not found"
}
```

**Error Response (500 Internal Server Error)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "<error_message>"
}
```

### 8. Create Forum Post

| **Field** | **Type** | **Description** | **Required** |
| --------- | -------- | --------------- | ------------ |
| `Authorization` | `string` | Access token for authentication. | Yes |
| `content` | `string` | Content of the forum post. | Yes |
| `picture_count` | `integer` | Number of pictures in the post. | No |
| `picture_names` | `array` | List of filenames for the pictures. | No |

**Request Example**:
```json
{
    "Authorization": "Bearer <access_token>",
    "content": "This is a new forum post.",
    "picture_count": 2,
    "picture_names": ["{hashvalue}-2024-01-01T12:34:56Z.jpg", "{hashvalue}-2024-01-01T12:35:56Z.jpg"]
}
```

**Response Example (201 Created)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `postid`  | `integer` | ID of the created post. |
| `created_at` | `string` | Timestamp of post creation. |

```json
{
    "postid": 1,
    "created_at": "2023-10-03T12:34:56Z"
}
```

**Error Response (400 Bad Request)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Content is required"
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Access token is required"
}
```

### 9. Create Forum Picture

| **Field** | **Type** | **Description** | **Required** |
| --------- | -------- | --------------- | ------------ |
| `Authorization` | `string` | Access token for authentication. | Yes |
| `image_type` | `string` | Type of the image (e.g., jpg, png). | Yes |
| `image_data` | `string` | Base64 encoded image data. (no more than 5MB) | Yes |

**Request Example**:
```json
{
    "Authorization": "Bearer <access_token>",
    "image_type": "jpg",
    "image_data": "<base64_encoded_image_data>"
}
```

**Response Example (201 Created)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `filename`     | `string` | filename of the uploaded image. |

```json
{
    "filename": "<image_hash>-<timestamp>.jpg"
}
```

**Error Response (400 Bad Request)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Image type is required"
}
```
```json
{
    "error": "Image data is required"
}
```
```json
{
    "error": "Invalid base64 data"
}
```
```json
{
    "error": "Image size exceeds 5MB"
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Access token is required"
}
```

### 10. Like Forum Post

| **Field** | **Type** | **Description** | **Required** |
| --------- | -------- | --------------- | ------------ |
| `Authorization` | `string` | Access token for authentication. | Yes |
| `postid` | `integer` | ID of the forum post to like/unlike. | Yes |

**Request Example**:
```json
{
    "Authorization": "Bearer <access_token>",
    "postid": 1
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `likes`   | `integer` | Total number of likes for the post. |
| `isliked` | `boolean` | Whether the post is liked by the user. |

```json
{
    "likes": 10,
    "isliked": true
}
```

### 11. Reply to Forum Post

| **Field** | **Type** | **Description** | **Required** |
| --------- | -------- | --------------- | ------------ |
| `Authorization` | `string` | Access token for authentication. | Yes |
| `postid` | `integer` | ID of the forum post to reply to. | Yes |
| `reply_content` | `string` | Content of the reply. | Yes |

**Request Example**:

```json
{
    "Authorization": "Bearer <access_token>",
    "postid": 1,
    "reply_content": "This is a reply to the forum post."
}
```

**Response Example (200 OK)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `replies` | `array`  | List of replies to the forum post. |

```json
{
    "replies": [
        {
            "reply_id": 1,
            "username": "user3",
            "content": "This is a reply."
        },
        {
            "reply_id": 2,
            "username": "user4",
            "content": "This is your new reply."
        }
    ]
}
```

**Error Response (400 Bad Request)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Postid is required"
}
```
```json
{
    "error": "Reply content is required"
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Access token is required"
}
```

**Error Response (404 Not Found)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Post not found"
}
```

**Error Response (400 Bad Request)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Postid is required"
}
```

**Error Response (401 Unauthorized)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Access token is required"
}
```

**Error Response (404 Not Found)**:

| **Field** | **Type** | **Description** |
| --------- | -------- | --------------- |
| `error`   | `string` | Error message.  |

```json
{
    "error": "Post not found"
}
```

---

## Status Codes

| **Status Code** | **Description**                                     |
| --------------- | --------------------------------------------------- |
| `200`           | OK                                                  |
| `400`           | Bad request                               |
| `401`           | Unauthorized - Invalid credentials or expired token |
| `405`           | Method not allowed                               |
| `409`           | Conflict                               |
| `429`           | Too many requests                               |
| `500`           | Internal Server Error                               |
